<form class="my-10 space-y-6" [formGroup]="resetForm" (ngSubmit)="onSubmit()">
  <div class="text-center">
    <h2 class="text-foreground mb-1 text-3xl font-semibold">Setup New Password</h2>
    <p class="text-muted-foreground text-sm">
      Have you already reset the password ? <a class="text-primary" routerLink="/auth/login"> Sign in</a>
    </p>
  </div>

  <!-- Token Error Message -->
  <div *ngIf="!token" class="bg-destructive/10 border-destructive/20 rounded-lg border p-4">
    <p class="text-destructive text-center text-sm">
      Invalid or missing reset token. Please request a new password reset link.
    </p>
  </div>

  <div class="space-y-3 text-left" *ngIf="token">
    <!-- Password Field -->
    <div class="form__group">
      <div class="relative">
        <input
          [type]="showPassword ? 'text' : 'password'"
          id="password"
          class="peer block w-full py-4"
          [ngClass]="{ 'is__invalid-input': submitted && f['password'].errors }"
          placeholder=" "
          formControlName="password"
          (input)="checkPasswordStrength()" />
        <label
          for="password"
          [ngClass]="{ 'peer-focus:text-destructive!': submitted && f['password'].errors }"
          class="bg-background text-muted-foreground peer-focus:text-primary absolute top-2 z-10 origin-[0] -translate-y-4 scale-95 transform px-2 text-sm duration-300 peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:scale-100 peer-focus:top-2 peer-focus:-translate-y-4 peer-focus:scale-95 peer-focus:px-2 ltr:left-1 rtl:right-1">
          Password
        </label>
        <span
          class="text-muted-foreground absolute top-1/2 -translate-y-1/2 transform cursor-pointer ltr:right-3 rtl:left-3"
          (click)="togglePasswordVisibility()">
          <svg-icon
            [src]="
              showPassword ? 'assets/icons/heroicons/outline/eye-off.svg' : 'assets/icons/heroicons/outline/eye.svg'
            "
            [svgClass]="'h-5 w-5'">
          </svg-icon>
        </span>
      </div>

      <!-- Password Validation Errors -->
      <div *ngIf="submitted && f['password'].errors" class="is__invalid-error mt-2">
        <div *ngIf="f['password'].errors['required']">Password is required</div>
        <div *ngIf="f['password'].errors['minlength']">Password must be at least 8 characters</div>
        <div *ngIf="f['password'].errors['pattern']">
          Password must include uppercase, lowercase, number, and special character
        </div>
      </div>
    </div>

    <!-- Password Strength Meter -->
    <div class="space-y-2">
      <div class="grid grid-cols-4 gap-2">
        <div class="rounded-xs h-1 transition-colors duration-300" [ngClass]="getPasswordStrengthColor(0)"></div>
        <div class="rounded-xs h-1 transition-colors duration-300" [ngClass]="getPasswordStrengthColor(1)"></div>
        <div class="rounded-xs h-1 transition-colors duration-300" [ngClass]="getPasswordStrengthColor(2)"></div>
        <div class="rounded-xs h-1 transition-colors duration-300" [ngClass]="getPasswordStrengthColor(3)"></div>
      </div>
      <div class="flex items-center justify-between">
        <span class="text-muted-foreground text-xs">
          Use 8 or more characters with a mix of letters, numbers & symbols.
        </span>
        <span
          class="text-xs font-medium"
          [ngClass]="{
            'text-destructive': passwordStrength <= 2,
            'text-warning': passwordStrength === 3,
            'text-success': passwordStrength >= 4
          }">
          {{ getPasswordStrengthText() }}
        </span>
      </div>
    </div>

    <!-- Confirm Password Field -->
    <div class="form__group">
      <div class="relative">
        <input
          [type]="showConfirmPassword ? 'text' : 'password'"
          id="confirm-password"
          class="peer block w-full py-4"
          [ngClass]="{ 'is__invalid-input': submitted && f['confirmPassword'].errors }"
          placeholder=" "
          formControlName="confirmPassword" />
        <label
          for="confirm-password"
          [ngClass]="{ 'peer-focus:text-destructive!': submitted && f['confirmPassword'].errors }"
          class="bg-background text-muted-foreground peer-focus:text-primary absolute top-2 z-10 origin-[0] -translate-y-4 scale-95 transform px-2 text-sm duration-300 peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:scale-100 peer-focus:top-2 peer-focus:-translate-y-4 peer-focus:scale-95 peer-focus:px-2 ltr:left-1 rtl:right-1">
          Confirm Password
        </label>
        <span
          class="text-muted-foreground absolute top-1/2 -translate-y-1/2 transform cursor-pointer ltr:right-3 rtl:left-3"
          (click)="toggleConfirmPasswordVisibility()">
          <svg-icon
            [src]="
              showConfirmPassword
                ? 'assets/icons/heroicons/outline/eye-off.svg'
                : 'assets/icons/heroicons/outline/eye.svg'
            "
            [svgClass]="'h-5 w-5'">
          </svg-icon>
        </span>
      </div>

      <!-- Confirm Password Validation Errors -->
      <div *ngIf="submitted && f['confirmPassword'].errors" class="is__invalid-error mt-2">
        <div *ngIf="f['confirmPassword'].errors['required']">Please confirm your password</div>
        <div *ngIf="f['confirmPassword'].errors['passwordMismatch']">Passwords do not match</div>
      </div>
    </div>
  </div>

  <!-- Submit Button -->
  <div>
    <app-button
      type="submit"
      full
      impact="bold"
      tone="primary"
      shape="rounded"
      size="medium"
      [disabled]="loading || !token">
      <span *ngIf="loading" class="mr-2 inline-block h-4 w-4 animate-spin rounded-full border-b-2 border-white"> </span>
      {{ loading ? 'Resetting Password...' : 'Reset Password' }}
    </app-button>
  </div>

  <!-- Request New Link -->
  <div *ngIf="!token" class="text-center">
    <p class="text-muted-foreground text-sm">
      Need a new reset link?
      <a class="text-primary hover:underline" routerLink="/auth/forgot-password"> Request another one </a>
    </p>
  </div>
</form>
